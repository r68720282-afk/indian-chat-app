<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DM Popup Demo â€” Dark Messenger Style</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0f16;
    --panel:#0f1620;
    --muted:#9aa6b2;
    --accent:#4dc9ff;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;font-family:'Poppins',sans-serif;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(77,201,255,0.03), transparent),
      linear-gradient(180deg,#061021,#071226);
    color:#e6eef6;
    display:flex;align-items:center;justify-content:center;padding:40px;
  }

  /* Container to mimic page */
  .page {
    width:100%;max-width:1100px;min-height:560px;border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    padding:20px; box-shadow: 0 10px 40px rgba(2,6,23,0.6);
    position:relative;
  }

  /* DM popup base */
  .dm {
    width:380px; max-height:74vh; background:var(--panel); border-radius:12px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    overflow:hidden; display:flex;flex-direction:column; transition:all .22s ease;
    position: absolute; right:24px; bottom:24px;
  }

  .dm.half { width: 720px; right:50%; transform:translateX(50%); bottom:24px; border-radius:12px; }
  .dm.full { width: calc(100% - 80px); height: calc(100% - 160px); right:40px; bottom:80px; transform:none; }

  /* header */
  .dm-header {
    display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  }
  .dm-left { display:flex;align-items:center;gap:12px }
  .avatar {
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#a86ef7);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:#061021;
    box-shadow:0 6px 18px rgba(77,201,255,0.06);
  }
  .meta { display:flex;flex-direction:column;line-height:1 }
  .meta .name { font-weight:700; font-size:15px }
  .meta .status { font-size:12px; color:var(--muted) }

  .dm-actions { display:flex;gap:8px;align-items:center }
  .icon-btn { width:36px;height:36px;border-radius:8px;background:var(--glass);border:none;color:var(--muted);display:inline-flex;align-items:center;justify-content:center;cursor:pointer }
  .icon-btn:hover { background:rgba(255,255,255,0.04); color:var(--accent) }

  /* messages area */
  .dm-body { padding:14px; overflow:auto; display:flex;flex-direction:column;gap:10px; flex:1; background: linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,255,255,0.01)); }
  .msg { max-width:72%; padding:10px 12px;border-radius:10px; line-height:1.3; font-size:14px; word-break:break-word; box-shadow:0 6px 18px rgba(0,0,0,0.25) }
  .msg.me { margin-left:auto; background:linear-gradient(90deg,var(--accent),#61d4ff); color:#061021; border-bottom-right-radius:4px;}
  .msg.them { margin-right:auto; background:rgba(255,255,255,0.03); color:#e8f0fb; border-bottom-left-radius:4px;}
  .msg .meta { display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--muted); margin-bottom:6px; }
  .system { text-align:center; color:var(--muted); font-size:13px; padding:6px 10px; }

  /* composer */
  .dm-footer { border-top:1px solid rgba(255,255,255,0.02); padding:10px; display:flex; gap:8px; align-items:end; background: linear-gradient(180deg, transparent, rgba(255,255,255,0.01)); }
  .dm-input { flex:1; display:flex; align-items:flex-end; gap:8px; }
  textarea.input { width:100%; min-height:40px; max-height:120px; resize:none; border-radius:8px; padding:10px 12px; border:none; background:rgba(255,255,255,0.02); color:#eaf6ff; outline:none; font-size:14px; }
  .send { padding:10px 14px; border-radius:10px; border:none; background:var(--accent); color:#061021; font-weight:700; cursor:pointer }
  .small-tip { font-size:12px; color:var(--muted); padding-left:6px }

  /* settings dropdown */
  .settings-menu {
    position: absolute; top:56px; right:14px; background:#0b1116; border-radius:8px; padding:8px; box-shadow:0 10px 30px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.02); display:none; z-index:50;
  }
  .settings-menu button { width:100%; background:transparent;border:none;color:var(--muted); padding:8px 12px; text-align:left; cursor:pointer; border-radius:6px }
  .settings-menu button:hover { background:rgba(255,255,255,0.02); color:var(--accent) }

  /* minimized state bar */
  .minibar { position: absolute; right:24px; bottom:16px; display:none; gap:8px; align-items:center; background: #0f1720; padding:8px 12px; border-radius:12px; box-shadow:0 10px 40px rgba(1,6,18,0.6) }
  .minibar .mini { display:flex; align-items:center; gap:10px; color:var(--muted) }

  /* responsive */
  @media (max-width:720px){
    .dm { width:100%; right:0; left:0; bottom:0; border-radius:12px 12px 0 0; }
    .dm.half { width:100%; transform:none; right:0; }
    .dm.full { width:100%; height:100vh; top:0; right:0; left:0; bottom:0; border-radius:0; }
    .page { padding:8px }
  }
</style>
</head>
<body>
  <div class="page">
    <h3 style="margin:12px 0 22px;color:var(--muted)">DM Popup Demo â€” Dark Minimal Messenger Style</h3>
    <p style="color:var(--muted)">This demo shows the popup UI. Toggle user type and interact with controls (minimize / maximize / settings). Save as <code>dm_popup_demo.html</code> and open in browser.</p>

    <!-- DM Popup -->
    <div id="dm" class="dm" role="dialog" aria-label="Direct Message Popup">
      <div class="dm-header">
        <div class="dm-left">
          <div class="avatar" id="avatar">P</div>
          <div class="meta">
            <div class="name" id="dName">Priya</div>
            <div class="status" id="dStatus">online â€¢ 2m ago</div>
          </div>
        </div>

        <div class="dm-actions">
          <!-- call/video/mic/file shown only for registered users by JS -->
          <button class="icon-btn" id="callBtn" title="Voice call" aria-label="Voice call">ðŸ“ž</button>
          <button class="icon-btn" id="videoBtn" title="Video call" aria-label="Video call">ðŸŽ¥</button>
          <button class="icon-btn" id="fileBtn" title="Send file" aria-label="File">ðŸ“Ž</button>

          <div style="position:relative">
            <button class="icon-btn" id="settingsBtn" title="Settings" aria-label="Settings">âš™</button>
            <div id="settingsMenu" class="settings-menu" aria-hidden="true">
              <button id="reportBtn">Report User</button>
              <button id="ignoreBtn">Ignore User</button>
              <button id="blockBtn">Block User</button>
              <button id="viewProfileBtn">View Profile</button>
            </div>
          </div>

          <button class="icon-btn" id="minBtn" title="Minimize" aria-label="Minimize">â€”</button>
          <button class="icon-btn" id="expandBtn" title="Maximize" aria-label="Expand">â¬œ</button>
          <button class="icon-btn" id="closeBtn" title="Close" aria-label="Close">âœ–</button>
        </div>
      </div>

      <!-- body -->
      <div id="dmBody" class="dm-body" aria-live="polite">
        <div class="system">â€” You matched with Priya â€”</div>

        <div class="msg them">
          <div class="meta"><span>Priya</span><span>6:05 PM</span></div>
          <div>Hey! How's it going?</div>
        </div>

        <div class="msg me">
          <div class="meta"><span>You</span><span>6:06 PM</span></div>
          <div>Good â€” testing the DM UI. Looks neat!</div>
        </div>

        <div class="msg them">
          <div class="meta"><span>Priya</span><span>6:07 PM</span></div>
          <div>Nice â€” can you send an image?</div>
        </div>
      </div>

      <!-- footer -->
      <div class="dm-footer">
        <div class="dm-input">
          <textarea id="dmInput" class="input" placeholder="Type a private message..."></textarea>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
          <div class="small-tip" id="tipText">Enter = Send â€¢ Shift+Enter = New line</div>
          <div style="display:flex;gap:8px">
            <button id="sendBtn" class="send">Send</button>
          </div>
        </div>
      </div>
    </div>

    <!-- minimized bar -->
    <div id="miniBar" class="minibar" aria-hidden="true">
      <div class="mini">
        <div style="width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#a86ef7);display:flex;align-items:center;justify-content:center;color:#061021;font-weight:700">P</div>
        <div style="display:flex;flex-direction:column">
          <div style="font-weight:700">Priya</div>
          <div style="font-size:12px;color:var(--muted)">1 new</div>
        </div>
      </div>
      <button class="icon-btn" id="restoreBtn">â–¢</button>
    </div>
  </div>

<script>
/* ---------- Demo JS: controls + guest/user toggles ---------- */

// set this to 'guest' or 'user' to test behavior
let USER_TYPE = 'guest'; // change to 'user' to see full icons

const dm = document.getElementById('dm');
const miniBar = document.getElementById('miniBar');
const settingsBtn = document.getElementById('settingsBtn');
const settingsMenu = document.getElementById('settingsMenu');
const minBtn = document.getElementById('minBtn');
const expandBtn = document.getElementById('expandBtn');
const closeBtn = document.getElementById('closeBtn');
const restoreBtn = document.getElementById('restoreBtn');

const callBtn = document.getElementById('callBtn');
const videoBtn = document.getElementById('videoBtn');
const fileBtn = document.getElementById('fileBtn');

const dmBody = document.getElementById('dmBody');
const input = document.getElementById('dmInput');
const sendBtn = document.getElementById('sendBtn');

// feature permissions (owner-controlled flags, demo values)
const OWNER_FLAGS = {
  allowGuestFiles: false,
  allowGuestCalls: false
};

// initial feature render based on user type + owner flags
function renderFeatureVisibility(){
  if(USER_TYPE === 'guest'){
    callBtn.style.display = OWNER_FLAGS.allowGuestCalls ? 'inline-flex' : 'none';
    videoBtn.style.display = 'none';
    fileBtn.style.display = OWNER_FLAGS.allowGuestFiles ? 'inline-flex' : 'none';
  } else {
    callBtn.style.display = 'inline-flex';
    videoBtn.style.display = 'inline-flex';
    fileBtn.style.display = 'inline-flex';
  }
}
renderFeatureVisibility();

// Settings menu toggle
settingsBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
  settingsMenu.setAttribute('aria-hidden', settingsMenu.style.display === 'none');
});

// close menus on outside click
document.addEventListener('click', (e)=>{
  if(!settingsMenu.contains(e.target) && e.target !== settingsBtn){
    settingsMenu.style.display = 'none';
  }
});

// Minimize: hide popup, show minibar
minBtn.addEventListener('click', ()=>{
  dm.style.display = 'none';
  miniBar.style.display = 'flex';
  miniBar.setAttribute('aria-hidden','false');
});

// Restore from minibar
restoreBtn.addEventListener('click', ()=>{
  dm.style.display = 'flex';
  miniBar.style.display = 'none';
});

// Expand / half / full toggle
let state = 'normal'; // normal / half / full
expandBtn.addEventListener('click', ()=>{
  if(state === 'normal'){
    dm.classList.add('half'); state = 'half';
    expandBtn.innerText = 'â–­'; // show different icon
  } else if(state === 'half'){
    dm.classList.add('full'); dm.classList.remove('half'); state = 'full';
    expandBtn.innerText = 'ðŸ——';
  } else {
    dm.classList.remove('half','full'); state = 'normal';
    expandBtn.innerText = 'â¬œ';
  }
});

// Close popup
closeBtn.addEventListener('click', ()=>{
  dm.remove();
  miniBar.style.display = 'none';
});

// Demo settings buttons
document.getElementById('reportBtn').addEventListener('click', ()=>{ alert('Reported user â€” demo'); settingsMenu.style.display='none'; });
document.getElementById('ignoreBtn').addEventListener('click', ()=>{ alert('User ignored â€” demo'); settingsMenu.style.display='none'; });
document.getElementById('blockBtn').addEventListener('click', ()=>{ alert('User blocked â€” demo'); settingsMenu.style.display='none'; });
document.getElementById('viewProfileBtn').addEventListener('click', ()=>{ alert('Open profile â€” demo'); settingsMenu.style.display='none'; });

// Keyboard behaviour: Enter sends, Shift+Enter newline
input.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

// send message - demo append
function sendMessage(){
  const txt = input.value.trim();
  if(!txt) return;
  appendMy(txt);
  input.value = '';
  input.style.height = '40px';
  // simulate remote reply after 800ms
  setTimeout(()=> appendThem("Nice! (auto reply)"), 800);
}

sendBtn.addEventListener('click', sendMessage);

function appendMy(text){
  const el = document.createElement('div');
  el.className = 'msg me';
  el.innerHTML = `<div class="meta"><span>You</span><span>${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span></div><div>${escapeHTML(text)}</div>`;
  dmBody.appendChild(el);
  dmBody.scrollTop = dmBody.scrollHeight;
}
function appendThem(text){
  const el = document.createElement('div');
  el.className = 'msg them';
  el.innerHTML = `<div class="meta"><span>Priya</span><span>${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span></div><div>${escapeHTML(text)}</div>`;
  dmBody.appendChild(el);
  dmBody.scrollTop = dmBody.scrollHeight;
}
function escapeHTML(str){ return str.replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

// small helper: toggle USER_TYPE from console for quick demo
window._setUserType = (t) => { USER_TYPE = t; renderFeatureVisibility(); alert('USER_TYPE set to '+t); }

// focus input on open
input.focus();

</script>
</body>
</html>
