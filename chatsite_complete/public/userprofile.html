<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>User Profile</title>

<style>

:root {
    --bg-light: #ffffff;
    --bg-dark: #0f0f16;
    --text-light: #0f0f16;
    --text-dark: #ffffff;
    --card-light: #f5f5f5;
    --card-dark: #1b1b33;
    --btn: #4dc9ff;
}

/* Theme auto */
body.light {
    background: var(--bg-light);
    color: var(--text-light);
}
body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
}

body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow-x: hidden;
}

.profile-panel {
    width: 100%;
    max-width: 480px;
    height: 90vh;
    background: var(--card-dark);
    border-radius: 20px;
    overflow-y: auto;
    color: white;
    position: relative;
}

.cover {
    width: 100%;
    height: 160px;
    background: #333;
    background-size: cover;
    background-position: center;
    position: relative;
    cursor: pointer;
}

.cover::after {
    content: "Upload Cover (GIF allowed)";
    position: absolute;
    bottom: 6px;
    left: 10px;
    font-size: 13px;
    background: rgba(0,0,0,0.45);
    padding: 3px 8px;
    border-radius: 6px;
}

.dp-wrap {
    position: relative;
    margin-top: -60px;
    display: flex;
    justify-content: center;
}

.dp {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    background: #444;
    border: 3px solid white;
    background-size: cover;
    background-position: center;
    cursor: pointer;
}

.section {
    padding: 20px;
}

.title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 8px;
}

.sub {
    opacity: 0.7;
    font-size: 15px;
    margin-bottom: 16px;
}

.item {
    padding: 14px;
    background: rgba(255,255,255,0.07);
    border-radius: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
}

.toggle {
    width: 44px;
    height: 26px;
    background: #555;
    border-radius: 20px;
    position: relative;
    cursor: pointer;
}
.toggle-circle {
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 3px;
    left: 3px;
    transition: .2s;
}
.toggle.on {
    background: #4dc9ff;
}
.toggle.on .toggle-circle {
    left: 21px;
}

.btn {
    width: 100%;
    padding: 14px;
    background: var(--btn);
    color: black;
    border: none;
    border-radius: 12px;
    font-size: 17px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
}

.close-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 22px;
    cursor: pointer;
}

.profile-info {
    text-align: center;
    margin-top: 10px;
}
.profile-info h2 {
    margin: 5px 0;
}
.profile-info p {
    opacity: 0.7;
    margin: 2px;
}

/* file input hidden */
input[type="file"] {
    display: none;
}

</style>
</head>

<body>

<div class="profile-panel" id="panel">

    <div class="close-btn" onclick="goBack()">âœ•</div>

    <!-- COVER -->
    <label for="coverInput">
        <div class="cover" id="cover"></div>
    </label>
    <input type="file" id="coverInput" accept="image/*,image/gif" />

    <!-- DP -->
    <div class="dp-wrap">
        <label for="dpInput">
            <div class="dp" id="dp"></div>
        </label>
        <input type="file" id="dpInput" accept="image/*" />
    </div>

    <!-- USER INFO -->
    <div class="profile-info">
        <h2 id="p_name">User</h2>
        <p id="p_email"></p>
        <p id="p_gender"></p>
        <p id="p_age"></p>
    </div>

    <!-- ACCOUNT SETTINGS -->
    <div class="section">
        <div class="title">Account</div>

        <div class="item" onclick="alert('Edit Info (coming soon)')">
            Edit Basic Info  
        </div>
        <div class="item" onclick="alert('Change Email (coming soon)')">
            Change Email  
        </div>
        <div class="item" onclick="alert('Change Password (coming soon)')">
            Change Password  
        </div>
    </div>

    <!-- MORE SETTINGS -->
    <div class="section">
        <div class="title">Preferences</div>

        <div class="item">
            <span>Private Mode</span>
            <div class="toggle" id="t_private"><div class="toggle-circle"></div></div>
        </div>

        <div class="item">
            <span>Calls Allowed</span>
            <div class="toggle" id="t_calls"><div class="toggle-circle"></div></div>
        </div>

        <div class="item">
            <span>Notifications</span>
            <div class="toggle" id="t_notify"><div class="toggle-circle"></div></div>
        </div>

        <div class="item">
            <span>Username Mentions</span>
            <div class="toggle" id="t_mention"><div class="toggle-circle"></div></div>
        </div>

    </div>

    <div class="section">
        <button class="btn" onclick="saveProfile()">Save Changes</button>
        <button class="btn" onclick="logout()" style="background:#ff4d4d;color:white;">Logout</button>
    </div>

</div>

<script>

// Load Theme
let theme = localStorage.getItem("chat_theme") || "dark";
document.body.classList.add(theme);

// Load user (registered or guest)
let reg = localStorage.getItem("registered_user");
let guest = localStorage.getItem("chat_username");
let user = {};

if (reg) {
    user = JSON.parse(reg);
} else if (guest) {
    user = JSON.parse(guest);
} else {
    window.location.href = "/";
}

// Display info
document.getElementById("p_name").innerText = user.username;
document.getElementById("p_email").innerText = user.email ? "Email: " + user.email : "Guest User";
document.getElementById("p_gender").innerText = "Gender: " + (user.gender || "-");
document.getElementById("p_age").innerText = "Age: " + (user.age || "-");

// DP load
let dp = localStorage.getItem("dp_image");
if (dp) document.getElementById("dp").style.backgroundImage = `url(${dp})`;

// Cover Image load
let cover = localStorage.getItem("cover_image");
if (cover) document.getElementById("cover").style.backgroundImage = `url(${cover})`;


// DP upload
document.getElementById("dpInput").addEventListener("change", e=>{
    let file = e.target.files[0];
    let reader = new FileReader();
    reader.onload = ()=> {
        localStorage.setItem("dp_image", reader.result);
        document.getElementById("dp").style.backgroundImage = `url(${reader.result})`;
    };
    reader.readAsDataURL(file);
});

// Cover upload
document.getElementById("coverInput").addEventListener("change", e=>{
    let file = e.target.files[0];
    let reader = new FileReader();
    reader.onload = ()=> {
        localStorage.setItem("cover_image", reader.result);
        document.getElementById("cover").style.backgroundImage = `url(${reader.result})`;
    };
    reader.readAsDataURL(file);
});

// Toggles
function initToggle(id, key) {
    let el = document.getElementById(id);
    let saved = localStorage.getItem(key) === "1";
    if (saved) el.classList.add("on");

    el.addEventListener("click", ()=>{
        el.classList.toggle("on");
    });
}
initToggle("t_private", "pref_private");
initToggle("t_calls", "pref_calls");
initToggle("t_notify", "pref_notify");
initToggle("t_mention", "pref_mention");


// Save
function saveProfile() {
    localStorage.setItem("pref_private", document.getElementById("t_private").classList.contains("on") ? "1":"0");
    localStorage.setItem("pref_calls", document.getElementById("t_calls").classList.contains("on") ? "1":"0");
    localStorage.setItem("pref_notify", document.getElementById("t_notify").classList.contains("on") ? "1":"0");
    localStorage.setItem("pref_mention", document.getElementById("t_mention").classList.contains("on") ? "1":"0");

    alert("Profile Saved");
}

// Go Back
function goBack() {
    window.location.href = "/rooms.html";
}

// Logout
function logout() {
    localStorage.removeItem("chat_username");
    localStorage.removeItem("registered_user");
    window.location.href = "/";
}

</script>

</body>
</html>
